<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="style.css" />
<title>VBScript (and Jscript) MSI CustomActions suck.</title>
</head>
<body>
<h1><a href='http://blogs.msdn.com/robmen/archive/2004/05/20/136530.aspx'>VBScript (and Jscript) MSI CustomActions suck.</a></h1>

<p>Today was one of those days where you finally get around to looking at the time and wonder where the heck the hours went.&nbsp; It wasn't even like I really got a lot done.&nbsp; I think my <a href="http://www.google.com/search?hl=en&amp;ie=UTF-8&amp;q=define%3Acontext+switch">context switch</a> costs have been really high lately.&nbsp; It feels good to finally be home chilling out to the <a href="http://www.discogs.com/release/238907">Perfecto Chills albums</a>.&nbsp; I thought I'd relate a short story to you why VBScript (and Jscript for that matter) should not be used for CustomActions in an MSI.</p>
<p>Today, I realized it was 15:39 when a fellow developer, we'll call him Joe, called me at work.&nbsp; My first thought was, &quot;Jeez, it's almost 4 o'clock and I haven't got anything done!&quot;&nbsp; My second thought was, &quot;I bet Joe is screwed.&quot;&nbsp; Joe only calls me when the <a href="http://wix.sourceforge.net/">WiX toolset</a> has completely failed or he has hit the wall with the Windows Installer.&nbsp; Today, Joe had hit the wall.</p>
<p>&quot;Rob, have you been tracking the email thread about the CustomAction of mine that is failing?&quot;&nbsp; I had seen this thread earlier in the day and remembered Joe mentioning something about a VBScript CustomAction.&nbsp; &quot;A little bit, you're not really using VBScript for your CustomAction, are you?&quot;</p>
<p>That was it.&nbsp; Joe was attempting to debug some rather complex issues with a VBScript CustomAction interacting with some COM components during an install.&nbsp; Everything seemed to work fine if he ran the VBScript (slightly modified) in the cscript.exe or wscript.exe hosts.&nbsp; However, when the script executed in the Windows Installers <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/script56/html/scripting.asp">ActiveScript engine</a> it failed in rather mysterious ways.</p>
<p>Interestingly enough, a Windows Installer developer attached one of the many emails that I send to people when they are having problems using VBScript for CustomActions.&nbsp; In those emails, I always suggest that script never be used for CustomActions in MSI.&nbsp; So, Joe called me and asked, &quot;So what can I do, Rob?&quot;</p>
<p>My answer was simple, &quot;Joe, there is a reason I recommend never using VBScript for CustomActions.&nbsp; It's because there isn't really a whole lot you can do when you get into this kind of situation.&quot;&nbsp; Then I provided him a few ideas that started with attempting to get the script debugger to somehow attach and try to then debug over to the COM component and ended up suggesting getting the command-line debugger attached to the COM component on load.&nbsp; None of which is trivial.</p>
<p>What I don't understand is why people completely disregard dire warnings that certain technologies should not be used in certain circumstances.&nbsp; Yes, I understand it is extremely easy to write CustomActions in VBScript.&nbsp; No, that doesn't make it a good thing to use in your install.</p>
<p>So, I'm blogging here tonight at the end of a very long day to share with you three reasons, I recommend you not use VBScript or Jscript for CustomActions:</p>
<p>1.&nbsp; <b>Robust code is difficult write in script.</b>&nbsp; Setup code must operate on machines that are in an unknown state. &nbsp;In such hostile environments, there are many different ways that code can fail.&nbsp; Properly recovering from error conditions is very important (even if it just results in rollback).&nbsp; &quot;On Error Resume Next&quot; is not conducive to proper error handling in code.&nbsp; For this reason alone, <a href="http://office.microsoft.com/">Microsoft Office</a> banned all script CustomActions from their MSI files.&nbsp; I am admittedly biased but I believe Office has one of the most impressive, smooth, and stable setup programs for the Windows platform, especially considering its complexity.</p>
<p>2.&nbsp; <b>Debugging script in the Windows Installer is difficult.</b>&nbsp; Some might even argue it is impossible to debug script CustomActions.&nbsp; As Joe is going to find out for the next few days, debugging the interactions between the Windows Installer, the scripting engine, and any other objects is a non-trivial task because the tools are so primitive.&nbsp; There are many tools for C/C++ code that can have very low impact on the machine if you are tracking a particularly skittish bug.&nbsp; Maybe I'm only called in when bugs are really hard, but there have been many times I was thankful for <a href="http://msdn.microsoft.com/library/en-us/ddtools/hh/ddtools/dbgblurb_25bn.asp">ntsd</a> and <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q286470">pageheap.exe</a>.</p>
<p>3.&nbsp; <b>Anti-virus products kill them.</b>&nbsp; This one just killed me.&nbsp; A couple years after Office banned the use of scripting for CustomActions, <a href="http://msdn.microsoft.com/vstudio/">Visual Studio</a> shipped their first MSI setup.&nbsp; They decided it would be okay if there were a few script CustomActions.&nbsp; When customers got the product, <a href="http://support.microsoft.com/directory/">PSS</a> started getting reports of the Visual Studio setup mysteriously failing and rollingback.&nbsp; After some very long calls, PSS discovered that if the users' anti-virus programs were disabled the installations would succeed.&nbsp; Turns out many of the top name anti-virus programs considered the scripts hosted by the Windows Installer to be virus and would kill the scripts off failing the Visual Studio install.</p>
<p>Anyway, hope you enjoyed the stories and remember, &quot;VBScript and Jscript suck for CustomActions.&quot;</p>
<p><i>Copyright © Rob Mensching</i></p>

</body>
</html>