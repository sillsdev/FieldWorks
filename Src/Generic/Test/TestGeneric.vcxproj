<?xml version="1.0" encoding="utf-8"?>
<!--
  TestGeneric - Native C++ Unit Tests for Generic Library

  This is a true MSBuild C++ project (not a Makefile wrapper).
  Converted from nmake-based build to enable:
  - Direct VS/VS Code builds without VsDevCmd.bat
  - vcpkg integration for GoogleTest
  - IntelliSense support
  - Parallel compilation

  Original Makefile wrapper backed up as TestGeneric.vcxproj.makefile.bak
-->
<Project DefaultTargets="Build" ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Build configurations -->
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>

  <!-- Project identity -->
  <PropertyGroup Label="Globals">
    <ProjectGuid>{C644C392-FB14-4DF1-9989-897E182D3849}</ProjectGuid>
    <ProjectName>TestGeneric</ProjectName>
    <RootNamespace>TestGeneric</RootNamespace>
    <Keyword>Win32Proj</Keyword>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
    <!-- vcpkg integration (when vcpkg.json manifest is present) -->
    <VcpkgEnabled>true</VcpkgEnabled>
    <VcpkgEnableManifest>true</VcpkgEnableManifest>
  </PropertyGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />

  <!-- Configuration type: Console Application (EXE) -->
  <!-- CharacterSet is NotSet because common.h defines _UNICODE and UNICODE itself -->
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>NotSet</CharacterSet>
    <UseDebugLibraries>true</UseDebugLibraries>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>NotSet</CharacterSet>
    <UseDebugLibraries>false</UseDebugLibraries>
    <WholeProgramOptimization>true</WholeProgramOptimization>
  </PropertyGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />

  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>

  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>

  <PropertyGroup Label="UserMacros">
    <!-- Repository root for include/lib paths -->
    <FwRoot>$(ProjectDir)..\..\..</FwRoot>
  </PropertyGroup>

  <!-- Output directories -->
  <PropertyGroup>
    <OutDir>$(FwRoot)\Output\$(Configuration)\</OutDir>
    <IntDir>$(FwRoot)\Obj\$(Configuration)\$(ProjectName)\</IntDir>
    <TargetName>testGenericLib</TargetName>
  </PropertyGroup>

  <!-- Debug configuration compiler/linker settings -->
  <!-- Matches settings from Bld/_init.mak: /W4 /WX /EHa /GR /GF /Zm400 /MDd /RTC1 /Zi /Od -->
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <Optimization>Disabled</Optimization>
      <AdditionalIncludeDirectories>
        $(FwRoot)\Include\unit++;
        $(FwRoot)\Include;
        $(FwRoot)\Src\Generic;
        $(FwRoot)\Src\Generic\Test;
        $(FwRoot)\Output\$(Configuration);
        $(FwRoot)\Output\$(Configuration)\Common;
        $(IntDir);
        %(AdditionalIncludeDirectories)
      </AdditionalIncludeDirectories>
      <PreprocessorDefinitions>
        WIN32=1;
        _DEBUG=1;
        DEBUG=1;
        _WINDOWS=1;
        _AFXDLL=1;
        _WIN32_WINNT=0x0A00;
        %(PreprocessorDefinitions)
      </PreprocessorDefinitions>
      <RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
      <WarningLevel>Level4</WarningLevel>
      <TreatWarningAsError>true</TreatWarningAsError>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <BasicRuntimeChecks>EnableFastChecks</BasicRuntimeChecks>
      <ExceptionHandling>Async</ExceptionHandling>
      <RuntimeTypeInfo>true</RuntimeTypeInfo>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
      <StringPooling>true</StringPooling>
      <!-- /EHa for async exception handling (required for C exception conversion) -->
      <!-- /GR for RTTI (required for dynamic_cast) -->
      <!-- /GF for string pooling -->
    </ClCompile>
    <Manifest>
      <AdditionalManifestFiles>$(ProjectDir)..\..\..\scripts\regfree\FieldWorks.regfree.manifest;%(AdditionalManifestFiles)</AdditionalManifestFiles>
    </Manifest>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <IgnoreSpecificDefaultLibraries>LIBCMT</IgnoreSpecificDefaultLibraries>
      <AdditionalLibraryDirectories>
        $(FwRoot)\Lib\$(Configuration);
        $(FwRoot)\Lib;
        $(FwRoot)\Output\$(Configuration)\lib\x64;
        %(AdditionalLibraryDirectories)
      </AdditionalLibraryDirectories>
      <AdditionalDependencies>
        unit++.lib;
        Generic.lib;
        DebugProcs.lib;
        icuin.lib;
        icudt.lib;
        icuuc.lib;
        uuid.lib;
        advapi32.lib;
        kernel32.lib;
        ole32.lib;
        oleaut32.lib;
        gdi32.lib;
        comctl32.lib;
        comdlg32.lib;
        shell32.lib;
        imm32.lib;
        ImageHlp.lib;
        Version.lib;
        winspool.lib;
        %(AdditionalDependencies)
      </AdditionalDependencies>
    </Link>
  </ItemDefinitionGroup>

  <!-- Release configuration compiler/linker settings -->
  <!-- Matches settings from Bld/_init.mak: /W4 /WX /EHa /GR /GF /MD /Zi /O2 /Ob1 /Gy -->
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <Optimization>MaxSpeed</Optimization>
      <InlineFunctionExpansion>OnlyExplicitInline</InlineFunctionExpansion>
      <AdditionalIncludeDirectories>
        $(FwRoot)\Include\unit++;
        $(FwRoot)\Include;
        $(FwRoot)\Src\Generic;
        $(FwRoot)\Src\Generic\Test;
        $(FwRoot)\Src\DebugProcs;
        $(FwRoot)\Output\$(Configuration);
        $(FwRoot)\Output\$(Configuration)\Common;
        $(IntDir);
        %(AdditionalIncludeDirectories)
      </AdditionalIncludeDirectories>
      <PreprocessorDefinitions>
        WIN32=1;
        NDEBUG=1;
        _WINDOWS=1;
        _AFXDLL=1;
        _WIN32_WINNT=0x0A00;
        %(PreprocessorDefinitions)
      </PreprocessorDefinitions>
      <RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
      <WarningLevel>Level4</WarningLevel>
      <TreatWarningAsError>true</TreatWarningAsError>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <ExceptionHandling>Async</ExceptionHandling>
      <RuntimeTypeInfo>true</RuntimeTypeInfo>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <StringPooling>true</StringPooling>
    </ClCompile>
    <Manifest>
      <AdditionalManifestFiles>$(ProjectDir)..\..\..\scripts\regfree\FieldWorks.regfree.manifest;%(AdditionalManifestFiles)</AdditionalManifestFiles>
    </Manifest>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <IgnoreSpecificDefaultLibraries>LIBCMT</IgnoreSpecificDefaultLibraries>
      <AdditionalLibraryDirectories>
        $(FwRoot)\Lib\$(Configuration);
        $(FwRoot)\Lib;
        $(FwRoot)\Output\$(Configuration)\lib\x64;
        %(AdditionalLibraryDirectories)
      </AdditionalLibraryDirectories>
      <AdditionalDependencies>
        unit++.lib;
        Generic.lib;
        icuin.lib;
        icudt.lib;
        icuuc.lib;
        uuid.lib;
        advapi32.lib;
        kernel32.lib;
        ole32.lib;
        oleaut32.lib;
        gdi32.lib;
        comctl32.lib;
        comdlg32.lib;
        shell32.lib;
        imm32.lib;
        ImageHlp.lib;
        Version.lib;
        winspool.lib;
        %(AdditionalDependencies)
      </AdditionalDependencies>
    </Link>
  </ItemDefinitionGroup>

  <!-- Source files -->
  <ItemGroup>
    <!-- Main test entry point and collection -->
    <ClCompile Include="testGeneric.cpp" />
    <ClCompile Include="Collection.cpp" />
    <!-- ModuleEntry from Generic (needed for DLL initialization) -->
    <ClCompile Include="..\ModuleEntry.cpp" />
  </ItemGroup>

  <!-- Header files -->
  <ItemGroup>
    <ClInclude Include="testGenericLib.h" />
    <ClInclude Include="TestSmartBstr.h" />
    <ClInclude Include="TestUtil.h" />
    <ClInclude Include="TestUtilXml.h" />
    <ClInclude Include="TestUtilString.h" />
    <ClInclude Include="TestErrorHandling.h" />
    <ClInclude Include="TestFwSettings.h" />
  </ItemGroup>

  <!-- Build tool reference files -->
  <ItemGroup>
    <None Include="testGenericLib.mak" />
  </ItemGroup>

  <!-- Pre-build: Generate Collection.cpp from test headers (same as makefile) -->
  <Target Name="GenerateCollection" BeforeTargets="ClCompile"
          Inputs="testGenericLib.h;TestSmartBstr.h;TestUtil.h;TestUtilXml.h;TestUtilString.h;TestErrorHandling.h;TestFwSettings.h"
          Outputs="Collection.cpp">
    <Message Text="Generating Collection.cpp from test headers..." Importance="high" />
    <Exec Command="$(FwRoot)\Bin\CollectUnit++Tests.cmd Generic testGenericLib.h TestSmartBstr.h TestUtil.h TestUtilXml.h TestUtilString.h TestErrorHandling.h TestFwSettings.h Collection.cpp"
          WorkingDirectory="$(ProjectDir)" />
  </Target>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>

</Project>
