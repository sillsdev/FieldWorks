openapi: 3.0.3
info:
  title: PrivateAssets Convergence Service Contract
  version: 1.0.0
  description: |
    Logical representation of the `convergence.py private-assets` CLI so that future automation
    (e.g., pipelines or bots) can call the same operations via service or task runners.
servers:
  - url: https://dev.local/fieldworks/convergence
paths:
  /private-assets/audit:
    post:
      summary: Enumerate projects whose `SIL.LCModel.*.Tests` references lack `PrivateAssets="All"`.
      operationId: auditPrivateAssets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditRequest'
      responses:
        '200':
          description: Audit finished successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditResponse'
  /private-assets/convert:
    post:
      summary: Apply `PrivateAssets="All"` to the targeted package references.
      operationId: convertPrivateAssets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConvertRequest'
      responses:
        '200':
          description: Conversion completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConvertResponse'
  /private-assets/validate:
    post:
      summary: Run post-conversion validation (nuget restore + MSBuild + NU1102 scan).
      operationId: validatePrivateAssets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateRequest'
      responses:
        '200':
          description: Validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateResponse'
components:
  schemas:
    AuditRequest:
      type: object
      properties:
        projectRoots:
          type: array
          items:
            type: string
          description: Absolute directories that contain `*Tests.csproj` files.
        packages:
          type: array
          items:
            type: string
          description: Package IDs to flag (default `SIL.LCModel.Core.Tests`, `SIL.LCModel.Tests`, `SIL.LCModel.Utils.Tests`).
      required: [projectRoots]
    AuditResponse:
      type: object
      properties:
        findings:
          type: array
          items:
            $ref: '#/components/schemas/AuditFinding'
        csvPath:
          type: string
          description: Location of `private_assets_audit.csv` on disk.
    AuditFinding:
      type: object
      properties:
        projectName:
          type: string
        csprojPath:
          type: string
        packagesMissingPrivateAssets:
          type: array
          items:
            type: string
    ConvertRequest:
      type: object
      properties:
        decisionsCsv:
          type: string
          description: Path to `private_assets_decisions.csv` controlling conversions.
      required: [decisionsCsv]
    ConvertResponse:
      type: object
      properties:
        updatedProjects:
          type: array
          items:
            type: string
          description: `.csproj` files that were edited.
        gitDiffSummary:
          type: string
    ValidateRequest:
      type: object
      properties:
        buildCommand:
          type: string
          description: Command to run (default `msbuild FieldWorks.sln /m /p:Configuration=Debug`).
      required: [buildCommand]
    ValidateResponse:
      type: object
      properties:
        status:
          type: string
          enum: [Succeeded, Failed]
        nuWarnings:
          type: array
          items:
            type: string
        logPath:
          type: string
