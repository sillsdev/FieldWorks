<?xml version="1.0" encoding="utf-8"?>
<Project
  DefaultTargets="Build"
  xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
  ToolsVersion="Current"
>
  <!--
    NativeBuild: Build orchestrator for native C++ component builds

    This project serves as a bridge between the MSBuild Traversal SDK (dirs.proj)
    and the native build system (mkall.targets). It allows the traversal
    build to properly sequence native component builds before managed projects.

    The project doesn't produce any output itself - it's purely a build orchestrator.
    Uses traditional MSBuild format to avoid SDK package resolution overhead.
  -->
  <PropertyGroup>
    <Platform Condition="'$(Platform)'==''">x64</Platform>
    <Configuration Condition="'$(Configuration)'==''">Debug</Configuration>
  </PropertyGroup>
  <!-- Import the native build orchestration -->
  <Import Project="$(MSBuildThisFileDirectory)..\..\FwBuildTasks.targets" />
  <Import Project="$(MSBuildThisFileDirectory)..\..\SetupInclude.targets" />
  <Import Project="$(MSBuildThisFileDirectory)..\..\mkall.targets" />
  <Import Project="$(MSBuildThisFileDirectory)..\..\Windows.targets" />
  <Import Project="$(MSBuildThisFileDirectory)..\..\RegFree.targets" />
  <Import Project="$(MSBuildThisFileDirectory)..\..\Localize.targets" />
  <!-- Override fwrt after imports - SetupInclude.targets computes it wrong for nested projects -->
  <PropertyGroup>
    <fwrt>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)..\..\..'))</fwrt>
    <!-- Also recompute all paths that depend on fwrt -->
    <DownloadsDir>$(fwrt)/Downloads</DownloadsDir>
    <PackagesDir>$(fwrt)/packages</PackagesDir>
    <LcmArtifactsDir>$(DownloadsDir)</LcmArtifactsDir>
  </PropertyGroup>
  <!-- Override the Build target to call native build instead -->
  <Target Name="Build" DependsOnTargets="allCppNoTest">
    <Message Text="Native C++ components built successfully" Importance="high" />
  </Target>
  <!-- Ensure Clean works -->
  <Target Name="Clean" DependsOnTargets="CleanAll">
    <Message Text="Native C++ components cleaned" Importance="high" />
  </Target>
</Project>
