<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="Current">
	<!--
		Native C++ Build Orchestration and Dependency Management for FieldWorks
		
		Modernized for MSBuild Traversal SDK - Legacy code removed
		
		Responsibilities:
		1. Native C++ component builds (DebugProcs, GenericLib, FwKernel, Views)
		2. Dependency management (NuGet packages, external artifacts)
		3. Code generation (CellarConstants)
		4. Clean/utility targets
		
		Note: PDB files are now handled by the SDK automatically.
		      Symbol package downloads have been removed.
	-->
	
<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="Current">
	<!--
		Native C++ Build Orchestration for FieldWorks
		
		This file coordinates building native C++ components (DebugProcs, GenericLib, FwKernel, Views)
		and their associated test executables. It is called by the MSBuild Traversal SDK via dirs.proj.
		
		Modern Build Path (MSBuild Traversal SDK):
		  dirs.proj → Build/FieldWorks.proj (target: allCppNoTest) → This file
		
		Key Targets:
		  - allCppNoTest: Build core native components (used by traversal SDK)
		  - Individual targets: DebugProcs, GenericLib, FwKernel, Views, etc.
	-->
	
	<!-- ======================================================================================== -->
	<!-- Main Native Build Target (Called by Traversal SDK)                                      -->
	<!-- ======================================================================================== -->
	<Target Name="allCppNoTest" DependsOnTargets="DebugProcs;GenericLib;FwKernel;Views" />
	<ItemGroup>
		<Fragments Include="$(dir-fwdistfiles)/*.fragment.manifest" />
	</ItemGroup>
	<Target
		Name="regFreeCpp"
		DependsOnTargets="FwKernel;Views"
		AfterTargets="FwKernel;Views"
		Condition="'$(OS)'=='Windows_NT'"
	>
		<RegFree
			Executable="$(dir-outputBase)/FwKernel.dll"
			Output="$(dir-outputBase)/FieldWorks.Tests.manifest"
			Dlls="$(dir-outputBase)\FwKernel.dll;$(dir-outputBase)\Views.dll"
			Fragments="@(Fragments)"
			Platform="$(Platform)"
			MSBuildArchitecture="$(Platform)"
		/>
	</Target>
	<Target Name="DebugProcs" DependsOnTargets="initWindows;CopyDlls">
		<Make
			Condition="'$(OS)'=='Windows_NT'"
			Makefile="$(fwrt)\Src\DebugProcs\DebugProcs.mak"
			Configuration="$(config-capital)"
			BuildRoot="$(fwrt)"
			BuildArch="'$(Platform)'"
			WorkingDirectory="$(fwrt)\Src\DebugProcs"
		/>
		<Message Text="Finished building DebugProcs." />
	</Target>
	<Target Name="GenericLib" DependsOnTargets="DebugProcs">
		<Make
			Condition="'$(OS)'=='Windows_NT'"
			Makefile="$(fwrt)\Src\Generic\GenericLib.mak"
			Configuration="$(config-capital)"
			BuildRoot="$(fwrt)"
			BuildArch="'$(Platform)'"
			WorkingDirectory="$(fwrt)\Src\Generic"
		/>
		<Message Text="Finished building GenericLib." />
	</Target>
	<Target
		Name="FwKernel"
		DependsOnTargets="GenericLib;GenerateCellarConstants;AppCore;CopyDlls"
	>
		<Message Text="FwKernel make-target='$(make-target)'" />
		<Make
			Condition="'$(OS)'=='Windows_NT'"
			Makefile="$(fwrt)\Src\Kernel\FwKernel.mak"
			Configuration="$(config-capital)"
			BuildRoot="$(fwrt)"
			BuildArch="'$(Platform)'"
			WorkingDirectory="$(fwrt)\Src\Kernel"
		/>
		<RegFree
			Executable="$(dir-outputBase)\FwKernel.dll"
			Output="$(dir-outputBase)\FwKernel.X.manifest"
			Condition="'$(OS)'=='Windows_NT'"
			Platform="$(Platform)"
			MSBuildArchitecture="$(Platform)"
		/>
		<Message Text="Finished building FwKernel." />
	</Target>
	<Target Name="AppCore" DependsOnTargets="DebugProcs;GenericLib">
		<Message Text="AppCore make-target='$(make-target)'" />
		<Message Text="Finished building AppCore." />
	</Target>
	<Target Name="Views" DependsOnTargets="GenericLib;FwKernel;GenerateCellarConstants">
		<Make
			Condition="'$(OS)'=='Windows_NT'"
			Makefile="$(fwrt)\Src\views\Views.mak"
			Configuration="$(config-capital)"
			BuildRoot="$(fwrt)"
			BuildArch="'$(Platform)'"
			WorkingDirectory="$(fwrt)\Src\views"
		/>
		<Message Text="RegFree processing Views.dll (Platform=$(Platform))" Importance="high" />
		<RegFree
			Executable="$(dir-outputBase)\Views.dll"
			Output="$(dir-outputBase)\Views.X.manifest"
			Condition="'$(OS)'=='Windows_NT'"
			Platform="$(Platform)"
			MSBuildArchitecture="$(Platform)"
			ContinueOnError="ErrorAndContinue"
		/>
		<Message Text="Finished building Views." />
	</Target>
	<UsingTask
		TaskName="LcmGenerate"
		AssemblyFile="$(LcmArtifactsDir)/SIL.LCModel.Build.Tasks.dll"
	/>
	<ItemGroup>
		<CellarConstantsInputs Include="$(LcmArtifactsDir)/MasterLCModel.xml" />
		<CellarConstantsInputs Include="$(fwrt)/Src/Kernel/CellarConstants.vm.h" />
		<CellarConstantsOutputs Include="$(fwrt)/Output/Common/CellarConstants.h" />
	</ItemGroup>
	<Target
		Name="GenerateCellarConstants"
		DependsOnTargets="CopyCellarBaseConstants;CopyDlls"
		Inputs="@(CellarConstantsInputs)"
		Outputs="@(CellarConstantsOutputs)"
	>
		<MakeDir Directories="$(dir-fwoutputCommon)" Condition="'$(action)'!='clean'" />
		<LcmGenerate
			XmlFile="$(LcmArtifactsDir)/MasterLCModel.xml"
			OutputDir="$(dir-fwoutputCommon)"
			OutputFile="CellarConstants.h"
			TemplateFile="$(fwrt)/Src/Kernel/CellarConstants.vm.h"
			WorkingDirectory="$(LcmArtifactsDir)/"
			Condition="'$(action)'!='clean'"
		/>
	</Target>
	<Target
		Name="CopyCellarBaseConstants"
		Inputs="$(fwrt)/Src/Kernel/CellarBaseConstants.h"
		Outputs="$(fwrt)/Output/Common/CellarBaseConstants.h"
	>
		<MakeDir Directories="$(dir-fwoutputCommon)" Condition="'$(action)'!='clean'" />
		<Copy
			SourceFiles="$(fwrt)/Src/Kernel/CellarBaseConstants.h"
			DestinationFolder="$(fwrt)/Output/Common"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(action)'!='clean'"
		/>
	</Target>
	<PropertyGroup>
		<Original-OBJ_DIR>$(OBJ_DIR)</Original-OBJ_DIR>
		<Original-BUILD4UX>$(BUILD4UX)</Original-BUILD4UX>
		<Original-ANAL_TYPE>$(ANAL_TYPE)</Original-ANAL_TYPE>
	</PropertyGroup>
	<Target
		Name="remakefw-internal"
		DependsOnTargets="CleanAll;Initialize;CopyDlls;setRegistryValues;GeneratePartsAndLayoutFiles;mkall"
	/>
	<ItemGroup>
		<!-- Don't delete FieldWorks.targets - that has to be done separately, otherwise we
		delete the file we just create previously when we run remakefw -->
		<!--<GeneratedFiles Include="$(fwrt)/Build/FieldWorks.targets"/>-->
		<GeneratedFiles Include="$(fwrt)/Src/**/Collection.cpp" />
		<GeneratedFiles Include="$(fwrt)/Src/**/asserts.log" />
		<GeneratedFiles Include="$(fwrt)/Src/Common/ViewsInterfaces/Views.cs" />
		<GeneratedFiles Include="$(fwrt)/Lib/debug/unit++.lib" />
		<GeneratedFiles Include="$(fwrt)/Lib/release/unit++.lib" />
		<GeneratedFiles Include="$(fwrt)/DistFiles/Parts/GeneratedParts.xml" />
		<GeneratedFiles Include="$(fwrt)/DistFiles/Parts/Generated.fwlayout" />
	</ItemGroup>
	<Target Name="CleanDownloads">
		<ForceDelete Files="$(DownloadsDir)" />
	</Target>
	<Target Name="Clean" DependsOnTargets="CleanAll">
		<ForceDelete Files="$(fwrt)/Build/FieldWorks.targets" />
	</Target>
	<Target Name="CleanAll" DependsOnTargets="cleanWindows">
		<!-- remove the Obj and Output directories -->
		<ForceDelete Files="$(dir-fwobj);$(dir-fwoutput)" />
		<!-- remove other directories and files created during the build process -->
		<ForceDelete Files="@(GeneratedFiles)" />
		<!-- remove LCM files -->
		<ItemGroup>
			<LcmFilesToDelete Include="$(fwrt)/Src/Kernel/*.idh" />
			<LcmFilesToDelete Include="$(fwrt)/Src/Kernel/FwKernelTlb.idl" />
			<LcmFilesToDelete Include="$(fwrt)/DistFiles/Styles.dtd" />
			<LcmFilesToDelete Include="$(fwrt)/DistFiles/Templates/GOLDEtic.xml" />
			<LcmFilesToDelete Include="$(fwrt)/DistFiles/Templates/NewLangProj.fwdata" />
			<LcmFilesToDelete Include="$(fwrt)/DistFiles/Templates/POS.xml" />
			<LcmFilesToDelete Include="$(fwrt)/DistFiles/Templates/SemDom.xml" />
			<LcmFilesToDelete Include="$(dir-fwoutputCommon)/FwKernelTlb.json" />
		</ItemGroup>
		<ForceDelete Files="@(LcmFilesToDelete)" />
		<ForceDelete Files="$(fwrt)/DistFiles/Icu$(IcuVersion)" />
		<Message Text="Finished deleting the output directories!" />
	</Target>
	<PropertyGroup>
		<MasterVersionInfo>$(fwrt)/Src/MasterVersionInfo.txt</MasterVersionInfo>
		<TeamCityUrl Condition="'$(TeamCityUrl)'==''">https://build.palaso.org/</TeamCityUrl>
		<!-- bt393 is the master branch build of ExCss for Windows development. Update when appropriate. -->
		<ExCssBuildType Condition="'$(OS)'=='Windows_NT'">bt393</ExCssBuildType>
		<ExCss Condition="'$(OS)'=='Windows_NT'">ExCss</ExCss>
		<ExCssBuildTag>.lastSuccessful</ExCssBuildTag>
		<GeckoFxHtmlToPdfBuildType Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'!='x64'"
			>GeckofxHtmlToPdf_GeckofxHtmlToPdfGeckofx60Win32continuous</GeckoFxHtmlToPdfBuildType
		>
		<GeckoFxHtmlToPdfBuildType Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'=='x64'"
			>GeckofxHtmlToPdf_Win64_continuous</GeckoFxHtmlToPdfBuildType
		>
		<GeckoFxHtmlToPdfBuildTag>.lastSuccessful</GeckoFxHtmlToPdfBuildTag>
		<!-- Versions of NuGet packages. Keep these in sync with PackageReference versions in the managed projects. -->
		<ChorusNugetVersion>6.0.0-beta0063</ChorusNugetVersion>
		<PalasoNugetVersion>17.0.0-beta0080</PalasoNugetVersion>
		<ParatextNugetVersion>9.4.0.1-beta</ParatextNugetVersion>
		<LcmNugetVersion>11.0.0-beta0140</LcmNugetVersion>
		<IcuNugetVersion>70.1.152</IcuNugetVersion>
		<HermitCrabNugetVersion>3.7.4</HermitCrabNugetVersion>
		<IPCFrameworkVersion>1.1.1-beta0001</IPCFrameworkVersion>
		<DownloadsDir>$(fwrt)/Downloads</DownloadsDir>
		<PackagesDir>$(fwrt)/packages</PackagesDir>
	</PropertyGroup>
	<ItemGroup>
		<PalasoFiles Include="SIL.Core.dll" />
		<PalasoFiles Include="SIL.Core.Desktop.dll" />
		<PalasoFiles Include="SIL.Lift.dll" />
		<PalasoFiles Include="SIL.Media.dll" />
		<PalasoFiles Include="SIL.Scripture.dll" />
		<PalasoFiles Include="SIL.Windows.Forms.dll" />
		<PalasoFiles Include="SIL.Windows.Forms.GeckoBrowserAdapter.dll" />
		<PalasoFiles Include="SIL.Archiving.dll" />
		<PalasoFiles Include="Keyman10Interop.dll" Condition="'$(OS)'=='Windows_NT'" />
		<PalasoFiles Include="Keyman7Interop.dll" Condition="'$(OS)'=='Windows_NT'" />
		<PalasoFiles Include="KeymanLink.dll" Condition="'$(OS)'=='Windows_NT'" />
		<PalasoFiles Include="SIL.WritingSystems.dll" />
		<PalasoFiles Include="SIL.WritingSystems.Tests.dll" />
		<PalasoFiles Include="SIL.Windows.Forms.Archiving.dll" />
		<PalasoFiles Include="SIL.Windows.Forms.WritingSystems.dll" />
		<PalasoFiles Include="System.Buffers.dll" />
		<PalasoFiles Include="System.Drawing.Common.dll" />
		<PalasoFiles Include="System.Memory.dll" />
		<PalasoFiles Include="SIL.Windows.Forms.Keyboarding.dll" />
		<PalasoFiles Include="SIL.Lexicon.dll" />
		<PalasoFiles Include="SIL.TestUtilities.dll" />
		<PalasoFiles Include="L10NSharp.dll" />
		<PalasoFiles Include="L10NSharp.Windows.Forms.dll" />
		<PalasoFiles Include="Interop.WIA.dll" />
		<PalasoFiles
			Include="lib/win-x86/irrKlang.NET4.dll"
			Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'!='x64'"
		/>
		<PalasoFiles
			Include="lib/win-x64/irrKlang.NET4.dll"
			Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'=='x64'"
		/>
		<PalasoFiles Include="Enchant.Net.dll" />
		<PalasoFiles Include="NDesk.DBus.dll" />
		<PalasoFiles Include="NDesk.DBus.dll.config" />
		<PalasoFiles Include="TagLibSharp.dll" />
		<PalasoFiles Include="Tenuto.dll" />
		<PalasoFiles Include="relaxngDatatype.dll" />
		<PalasoFiles Include="Spart.dll" />
		<ChorusFiles Include="Autofac.dll" />
		<ChorusFiles Include="Chorus.exe" />
		<ChorusFiles Include="LibChorus.dll" />
		<ChorusFiles Include="Vulcan.Uczniowie.HelpProvider.dll" />
		<IcuFiles Include="gennorm2.exe" />
		<IcuFiles Include="icudt$(IcuVersion).dll" />
		<IcuFiles Include="icuin$(IcuVersion).dll" />
		<IcuFiles Include="icutu$(IcuVersion).dll" />
		<IcuFiles Include="icuuc$(IcuVersion).dll" />
		<IcuFiles Include="icudt.lib" />
		<IcuFiles Include="icuin.lib" />
		<IcuFiles Include="icuuc.lib" />
		<LcmOutputBaseFiles Include="ICSharpCode.SharpZipLib.dll" />
		<LcmOutputBaseFiles Include="WeCantSpell.Hunspell.dll" />
		<LcmOutputBaseFiles Include="CommonServiceLocator.dll" />
		<LcmOutputBaseFiles Include="protobuf-net.dll" />
		<LcmOutputBaseFiles Include="StructureMap.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.FixData.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Utils.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Utils.Tests.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Utils.Tests.dll.config" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Core.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Core.dll.config" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Core.Tests.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Core.Tests.dll.config" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Build.Tasks.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Tools.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Tests.dll" />
		<LcmOutputBaseFiles Include="SIL.LCModel.Tests.dll.config" />
		<LcmOutputCommonFiles Include="KernelInterfaces/FwKernelTlb.json" />
		<LcmFwKernelFiles Include="KernelInterfaces/common.idh" />
		<LcmFwKernelFiles Include="KernelInterfaces/FwKernel.idh" />
		<LcmFwKernelFiles Include="KernelInterfaces/Language.idh" />
		<LcmFwKernelFiles Include="KernelInterfaces/TextServ.idh" />
		<LcmFwKernelFiles Include="KernelInterfaces/FwKernelTlb.idl" />
		<LcmDistFiles Include="Styles.dtd" />
		<!-- GOLDEtic.xml is copied so that developers can use grammatical categories without building localizations.
			Building localizations will overwrite this file with the latest translations. -->
		<LcmTemplatesFiles Include="Templates/GOLDEtic.xml" />
		<LcmTemplatesFiles Include="Templates/NewLangProj.fwdata" />
		<LcmTemplatesFiles Include="Templates/POS.xml" />
		<LcmTemplatesFiles Include="Templates/SemDom.xml" />
		<LcmIcuDataFiles Include="IcuData/data/nfc.txt" />
		<LcmIcuDataFiles Include="IcuData/data/nfcHebrew.txt" />
		<LcmIcuDataFiles Include="IcuData/data/nfcOverrides.txt" />
		<LcmIcuDataFiles Include="IcuData/data/nfkc.txt" />
		<LcmIcuDataFiles Include="IcuData/data/nfkcOverrides.txt" />
		<LcmIcuDataFiles Include="IcuData/data/UnicodeDataOverrides.txt" />
		<LcmIcuNrmFiles Include="IcuData/icudt$(IcuVersion)l/nfc_fw.nrm" />
		<LcmIcuNrmFiles Include="IcuData/icudt$(IcuVersion)l/nfkc_fw.nrm" />
		<LcmMissingFiles Include="SIL.LCModel.dll.config" />
	</ItemGroup>
	<!-- Restore NuGet packages for SDK-style projects -->
	<Target Name="RestorePackages">
		<Message Text="Restoring NuGet packages with dotnet restore..." />
		<Exec
			Command="dotnet restore &quot;$(fwrt)\FieldWorks.sln&quot; --packages &quot;$(PackagesDir)&quot;"
			ContinueOnError="false"
		/>
	</Target>
	<Target
		Name="downloadDlls"
		DependsOnTargets="RestorePackages;DefineNugetPackages"
		Condition="'$(disableDownloads)'!='true'"
	>
		<MakeDir Directories="$(DownloadsDir)" />
		<MakeDir Directories="$(DownloadsDir)/lib" />
		<MakeDir Directories="$(DownloadsDir)/lib/x64" />
		<MakeDir Directories="$(DownloadsDir)/lib/x86" />
		<!-- TODO (Hasso) 2011.11: copy on Condition="'$(UseLocalLibraries)'!='Y'" -->
		<Message Text="Copying artifacts from Palaso, Chorus, LCM, and related packages to Downloads." />
		<Copy
			SourceFiles="@(SILNugetFiles)"
			DestinationFolder="$(DownloadsDir)/%(RecursiveDir)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Message
			Text="(Palaso, Chorus, and LCM artifacts will be copied to Output from $(PalasoArtifactsDir), $(ChorusArtifactsDir), and $(LcmArtifactsDir), respectively, as  specified in LibraryDevelopment.targets)"
			Condition="'$(UseLocalLibraries)'=='Y'"
		/>
		<Message
			Text="Downloading artifacts for $(ExCss)."
			Condition="'$(OS)'=='Windows_NT' AND '$(TeamCityUrl)'!=''"
		/>
		<DownloadFilesFromTeamCity
			Address="$(TeamCityUrl)"
			BuildType="$(ExCssBuildType)"
			Tag="$(ExCssBuildTag)"
			Artifacts="$(ExCss).dll"
			DownloadsDir="$(DownloadsDir)"
			Condition="'$(OS)'=='Windows_NT' AND '$(TeamCityUrl)'!=''"
		/>
		<Message
			Text="Downloading artifacts for geckofxHtmlToPdf."
			Condition="'$(OS)'=='Windows_NT' AND '$(TeamCityUrl)'!=''"
		/>
		<DownloadFilesFromTeamCity
			Address="$(TeamCityUrl)"
			BuildType="$(GeckoFxHtmlToPdfBuildType)"
			Tag="$(GeckoFxHtmlToPdfBuildTag)"
			Artifacts="GeckofxHtmlToPdf.exe;GeckofxHtmlToPdf.exe.config;Args.dll"
			DownloadsDir="$(DownloadsDir)"
			Condition="'$(OS)'=='Windows_NT' AND '$(TeamCityUrl)'!=''"
		/>
		<Message
			Text="Using pre-populated downloads directory for ExCss and GeckofxHtmlToPdf artifacts."
			Condition="'$(TeamCityUrl)'==''"
		/>
		<Error
			Text="GeckofxHtmlToPdf.exe not found - PDF export will not work. Build from https://github.com/sillsdev/geckofxHtmlToPdf and place output in Downloads directory."
			Condition="!Exists('$(DownloadsDir)/GeckofxHtmlToPdf.exe')"
		/>
		<!-- Collect NuGet package files (PDB symbol packages no longer downloaded - SDK handles this) -->
		<ItemGroup>
			<SILNugetFiles Include="$(PackagesDir)/$([System.String]::new('%(SILNugetPackages.Identity)').ToLower())/%(SILNugetPackages.Version)/%(SILNugetPackages.Path)" />
		</ItemGroup>
	</Target>
	<Target Name="DefineNugetPackages">
		<ItemGroup>
			<!-- These NuGet packages used to arrive from our legacy CI. Because copyDlls can copy either downloaded or locally-built artifacts, copy them all to Downloads so the directory structure matches (locally-built artifacts have no separate packages). -->
			<!-- ICU binaries: x64 only for 64-bit builds -->
			<SILNugetPackages
				Include="Icu4c.Win.Fw.Bin"
				Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'=='x64'"
			>
				<Version>$(IcuNugetVersion)</Version>
				<Path>build/win-x64/*.*</Path>
			</SILNugetPackages>
			<!-- ICU DLLs: x64 runtime files -->
			<SILNugetPackages
				Include="Icu4c.Win.Fw.Lib"
				Condition="'$(OS)'=='Windows_NT' AND '$(Platform)'=='x64'"
			>
				<Version>$(IcuNugetVersion)</Version>
				<Path>runtimes/win7-x64/native/*.*</Path>
			</SILNugetPackages>
			<!-- ICU static libraries: x64 lib files for linking -->
			<SILNugetPackages Include="Icu4c.Win.Fw.Lib" Condition="'$(Platform)'=='x64'">
				<Version>$(IcuNugetVersion)</Version>
				<Path>build/native/lib/win7-x64/*.*</Path>
			</SILNugetPackages>
			<!-- ICU headers: platform-independent -->
			<SILNugetPackages Include="Icu4c.Win.Fw.Lib">
				<Version>$(IcuNugetVersion)</Version>
				<Path>build/native/include/**/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.FLExBridge.IPCFramework">
				<Version>$(IPCFrameworkVersion)</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<!-- LCM and related packages -->
			<!-- Note: PDB files are now handled by the SDK automatically, no longer copied manually -->
			<SILNugetPackages Include="SIL.LCModel">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel">
				<Version>$(LcmNugetVersion)</Version>
				<Path>contentFiles/**/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Build.Tasks">
				<Version>$(LcmNugetVersion)</Version>
				<Path>tools/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Core">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Core">
				<Version>$(LcmNugetVersion)</Version>
				<Path>contentFiles/**/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Core.Tests">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.FixData">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Utils">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Utils.Tests">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Tests">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.LCModel.Tools">
				<Version>$(LcmNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="CommonServiceLocator">
				<Version>2.0.7</Version>
				<Path>lib/net46/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="WeCantSpell.Hunspell">
				<Version>6.0.0</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="protobuf-net">
				<Version>2.4.6</Version>
				<Path>lib/net40/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SharpZipLib">
				<Version>1.4.0</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="structuremap.patched">
				<Version>4.7.3</Version>
				<Path>lib/net45/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="System.CodeDom">
				<Version>4.4.0</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<!-- Palaso and related packages -->
			<SILNugetPackages Include="SIL.Archiving">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Archiving">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>contentFiles/any/any/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Core">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Core.Desktop">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Media">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>build/**/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Media">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Media">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>contentFiles/any/any/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Lift">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Lexicon">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.TestUtilities">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Scripture">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms" Condition="'$(Platform)'!='x64'">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>build/Interop.WIA.dll</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms" Condition="'$(Platform)'=='x64'">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>build/x64/Interop.WIA.dll</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.Archiving">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.Archiving">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>contentFiles/any/any/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.Keyboarding">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.Keyboarding">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>build/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.Keyboarding">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>contentFiles/any/any/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.GeckoBrowserAdapter">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Windows.Forms.WritingSystems">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.WritingSystems">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.WritingSystems.Tests">
				<Version>$(PalasoNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="System.Buffers">
				<Version>4.6.0</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="System.Drawing.Common">
				<Version>9.0.0</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="System.Memory">
				<Version>4.5.4</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="System.Resources.Extensions">
				<Version>8.0.0</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="L10NSharp">
				<Version>9.0.0-beta0001</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="L10NSharp.Windows.Forms">
				<Version>9.0.0-beta0001</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Enchant.Net">
				<Version>1.4.3-beta0010</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Enchant.Net">
				<Version>1.4.3-beta0010</Version>
				<Path>contentFiles/any/any/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="NDesk.DBus">
				<Version>0.15.0</Version>
				<Path>lib/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Spart">
				<Version>1.0.0</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="TagLibSharp">
				<Version>2.2.0</Version>
				<Path>lib/net45/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Tenuto">
				<Version>1.0.0.39</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="relaxngDatatype">
				<Version>1.0.0.39</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="KeymanLegacyBundle">
				<Version>1.0.0</Version>
				<Path>lib/*.*</Path>
			</SILNugetPackages>
			<!-- Chorus and related packages -->
			<SILNugetPackages Include="SIL.Chorus.LibChorus">
				<Version>$(ChorusNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Chorus.App">
				<Version>$(ChorusNugetVersion)</Version>
				<Path>lib/net462/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Autofac">
				<Version>4.9.4</Version>
				<Path>lib/net45/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Vulcan.Uczniowie.HelpProvider">
				<Version>1.0.16</Version>
				<Path>lib/net461/*.*</Path>
			</SILNugetPackages>
			<!-- HermitCrab and related packages -->
			<SILNugetPackages Include="SIL.Machine.Morphology.HermitCrab">
				<Version>$(HermitCrabNugetVersion)</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="SIL.Machine">
				<Version>$(HermitCrabNugetVersion)</Version>
				<Path>lib/netstandard2.0/*.*</Path>
			</SILNugetPackages>
			<SILNugetPackages Include="Sandwych.Quickgraph.Core">
				<Version>1.0.0</Version>
				<Path>lib/net45/*.*</Path>
			</SILNugetPackages>
		</ItemGroup>
	</Target>
	<!-- Setup source variables (to enable local development in libpalaso, chorus, and liblcm) -->
	<PropertyGroup>
		<PalasoArtifactsDir Condition="'$(PalasoArtifactsDir)'==''"
			>$(DownloadsDir)</PalasoArtifactsDir
		>
		<ChorusArtifactsDir Condition="'$(ChorusArtifactsDir)'==''"
			>$(DownloadsDir)</ChorusArtifactsDir
		>
		<LcmArtifactsDir Condition="'$(LcmArtifactsDir)'==''">$(DownloadsDir)</LcmArtifactsDir>
	</PropertyGroup>
	<!-- item group for downloads, to allow easy copying -->
	<!-- wildcards don't work unless the files have already been downloaded once -->
	<ItemGroup>
		<!-- we need to explicitly specify the important files, otherwise they'll be ignored
		if they don't exist by the time this ItemGroup is read -->
		<DownloadedFiles Include="$(DownloadsDir)/IPCFramework.dll" />
		<DownloadedFiles
			Include="$(DownloadsDir)/Args.dll"
			Condition="Exists('$(DownloadsDir)/Args.dll')"
		/>
		<DownloadedFiles
			Include="$(DownloadsDir)/ExCss.dll"
			Condition="Exists('$(DownloadsDir)/ExCss.dll')"
		/>
		<DownloadedFiles
			Include="$(DownloadsDir)/ExCSS.dll"
			Condition="Exists('$(DownloadsDir)/ExCSS.dll')"
		/>
		<!-- PDB files for ExCss are now handled by SDK, no longer copied manually -->
		<DownloadedFiles Include="$(DownloadsDir)/Sandwych.Quickgraph.Core.dll" />
		<DownloadedFiles Include="$(DownloadsDir)/SIL.Machine.dll" />
		<DownloadedFiles Include="$(DownloadsDir)/SIL.Machine.Morphology.HermitCrab.dll" />
	</ItemGroup>
	<Target Name="CopyDlls" DependsOnTargets="downloadDlls;copyLibL10ns">
		<!-- .Net assemblies -->
		<Copy
			SourceFiles="$(fwrt)/DistFiles/LinqBridge.dll"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="$(fwrt)/DistFiles/log4net.dll"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="$(fwrt)/Lib/Common/Interop.ResourceDriver.dll"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<!-- Windows dynamically loaded libraries -->
		<Copy
			SourceFiles="$(fwrt)/DistFiles/xample32.dll"
			DestinationFiles="$(dir-outputBase)/xample.dll"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'  AND '$(arch)'!='x64'"
		/>
		<Copy
			SourceFiles="$(fwrt)/DistFiles/xample64.dll"
			DestinationFiles="$(dir-outputBase)/xample.dll"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT' AND '$(arch)'=='x64'"
		/>
		<!-- ICU libs - copy directly from NuGet packages -->
		<Copy
			SourceFiles="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/build/native/lib/win7-$(arch)/icudt.lib"
			DestinationFolder="$(fwrt)/Lib"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<Copy
			SourceFiles="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/build/native/lib/win7-$(arch)/icuin.lib"
			DestinationFolder="$(fwrt)/Lib"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<Copy
			SourceFiles="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/build/native/lib/win7-$(arch)/icuuc.lib"
			DestinationFolder="$(fwrt)/Lib"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<!-- ICU headers - copy directly from NuGet package -->
		<ItemGroup>
			<IcuHeaders Include="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/build/native/include/unicode/*.h" />
		</ItemGroup>
		<!-- ICU sources -->
		<Copy
			Sourcefiles="@(IcuHeaders)"
			DestinationFolder="$(fwrt)/Include/unicode"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<!-- Copy ICU dll's and exe's to lib/x64 and lib/x86 - copy directly from NuGet packages -->
		<ItemGroup>
			<IcuFileSet32 Include="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/runtimes/win7-x86/native/icu*.dll" />
			<IcuFileSet32 Include="$(PackagesDir)/icu4c.win.fw.bin/$(IcuNugetVersion)/build/win-x86/gennorm2.exe" />
		</ItemGroup>
		<ItemGroup>
			<IcuFileSet64 Include="$(PackagesDir)/icu4c.win.fw.lib/$(IcuNugetVersion)/runtimes/win7-x64/native/icu*.dll" />
			<IcuFileSet64 Include="$(PackagesDir)/icu4c.win.fw.bin/$(IcuNugetVersion)/build/win-x64/gennorm2.exe" />
		</ItemGroup>
		<!-- Include 32-bit ICU, even if arch is x64, so we can provide 32-bit ICU for 32-bit Paratext to use when the tools interact. -->
		<Copy
			SourceFiles="@(IcuFileSet32)"
			DestinationFolder="$(dir-outputBase)/lib/x86"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<Copy
			SourceFiles="@(IcuFileSet64)"
			DestinationFolder="$(dir-outputBase)/lib/x64"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT' AND '$(arch)'=='x64'"
		/>
		<!-- LCM dlls -->
		<Copy
			SourceFiles="@(LcmOutputBaseFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmOutputCommonFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(dir-fwoutputCommon)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmFwKernelFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(fwrt)/Src/Kernel"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmDistFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(fwrt)/DistFiles"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmTemplatesFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(fwrt)/DistFiles/Templates"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmIcuDataFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(fwrt)/DistFiles/Icu$(IcuVersion)/data"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(LcmIcuNrmFiles -&gt; '$(LcmArtifactsDir)/%(Identity)')"
			DestinationFolder="$(fwrt)/DistFiles/Icu$(IcuVersion)/icudt$(IcuVersion)l"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Error
			Condition="Exists(@(LcmMissingFiles -&gt; '$(LcmArtifactsDir)/%(Identity)'))"
			Text="The file '%(LcmMissingFiles.Identity)' has been reintroduced in the Nuget package and should be copied in the steps above."
		/>
		<!-- Copy the downloaded artifacts -->
		<Copy
			SourceFiles="@(PalasoFiles -&gt; '$(PalasoArtifactsDir)/%(Identity)')"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(ChorusFiles -&gt; '$(ChorusArtifactsDir)/%(Identity)')"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(DownloadedFiles)"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<!-- Rename GeckofxHtmlToPdf.exe to FieldWorksPdfMaker so it its origin is clear in case a user needs to release it from antivirus quarantine -->
		<!-- TODO: GeckofxHtmlToPdf needs to be built from https://github.com/sillsdev/geckofxHtmlToPdf and binaries placed in Downloads or DistFiles/Windows -->
		<Copy
			SourceFiles="$(DownloadsDir)/GeckofxHtmlToPdf.exe"
			DestinationFiles="$(dir-outputBase)/FieldWorksPdfMaker.exe"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="Exists('$(DownloadsDir)/GeckofxHtmlToPdf.exe')"
		/>
		<Copy
			SourceFiles="$(DownloadsDir)/GeckofxHtmlToPdf.exe.config"
			DestinationFiles="$(dir-outputBase)/FieldWorksPdfMaker.exe.config"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="Exists('$(DownloadsDir)/GeckofxHtmlToPdf.exe.config')"
		/>
		<!-- Encoding Converters Files -->
		<Copy
			SourceFiles="@(ECWindowsFiles -&gt; '$(PackagesDir)/Encoding-Converters-Core.$(ECNugetVersion)/runtimes/win-$(arch)/native/%(Identity)')"
			DestinationFolder="$(dir-outputBase)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<Copy
			SourceFiles="@(ECPlugins -&gt; '$(PackagesDir)/Encoding-Converters-Core.$(ECNugetVersion)/redist/EC/Plugins/%(Identity)')"
			DestinationFolder="$(dir-outputBase)/EC/Plugins"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<!-- NuGet packages. Property- and ItemGroups are inside the target so $(arch) and *'s are read properly -->
		<PropertyGroup>
			<!-- This package must be updated in encoding-converters-core also -->
			<Architecture Condition="'$(Platform)'=='x64'">64</Architecture>
			<Architecture Condition="'$(Platform)'!='x64'">32</Architecture>
			<GeckoDir Condition="'$(OS)'=='Windows_NT'"
				>$(PackagesDir)/Geckofx60.$(Architecture).60.0.54</GeckoDir
			>
			<OsDir Condition="'$(OS)'=='Windows_NT'">win</OsDir>
		</PropertyGroup>
		<ItemGroup>
			<NuGottenForBuildTasks Include="$(PackagesDir)/SIL.BuildTasks.2.6.0-beta0008/tools/SIL.BuildTasks.dll" />
			<NuGottenFiles
				Include="$(GeckoDir)/lib/net45/*.*"
				Condition="'$(OS)'=='Windows_NT'"
			/>
			<NuGottenFiles Include="$(GeckoDir)/content/**/*.*" />
			<NuGottenFiles Include="$(PackagesDir)/Analytics.3.6.0/lib/net461/Analytics.dll" />
			<NuGottenFiles Include="$(PackagesDir)/DocumentFormat.OpenXml.2.20.0/lib/net46/DocumentFormat.OpenXml.dll" />
			<NuGottenFiles Include="$(PackagesDir)/DotNetZip.1.16.0/lib/net40/*.*" />
			<NuGottenFiles Include="$(PackagesDir)/icu.net.3.0.0-beta.297/lib/netstandard2.0/icu.net.dll" />
			<NuGottenFiles Include="$(PackagesDir)/Markdig.Signed.0.30.0/lib/net452/Markdig.Signed.dll" />
			<NuGottenFiles Include="$(PackagesDir)/Microsoft.Extensions.DependencyModel.2.0.4/lib/net451/Microsoft.Extensions.DependencyModel.dll" />
			<NuGottenFiles
				Include="$(PackagesDir)/Microsoft.Win32.Registry.4.7.0/lib/net461/Microsoft.Win32.Registry.dll"
				Condition="'$(OS)'=='Windows_NT'"
			/>
			<NuGottenFiles Include="$(PackagesDir)/Moq.4.17.2/lib/net45/Moq.dll" />
			<NuGottenFiles Include="$(PackagesDir)/NAudio.1.10.0/lib/net35/NAudio.dll" />
			<NuGottenFiles Include="$(PackagesDir)/Castle.Core.4.4.1/lib/net45/Castle.Core.dll" />
			<NuGottenFiles Include="$(PackagesDir)/CommandLineArgumentsParser.3.0.22/lib/net45/CommandLineArgumentsParser.dll" />
			<NuGottenFiles Include="$(PackagesDir)/CsvHelper.28.0.1/lib/net45/CsvHelper.dll" />
			<NuGottenFiles Include="$(PackagesDir)/NAudio.Lame.1.1.5/lib/netstandard2.0/NAudio.Lame.dll" />
			<NuGottenFiles
				Include="$(PackagesDir)/NAudio.Lame.1.1.5/build/libmp3lame.32.dll"
				Condition="'$(OS)'=='Windows_NT' AND '$(arch)'!='x64'"
			/>
			<NuGottenFiles
				Include="$(PackagesDir)/NAudio.Lame.1.1.5/build/libmp3lame.64.dll"
				Condition="'$(OS)'=='Windows_NT' AND '$(arch)'=='x64'"
			/>
			<NuGottenFiles Include="$(PackagesDir)/Newtonsoft.Json.13.0.3/lib/net45/Newtonsoft.Json.dll" />
			<NuGottenFiles Include="$(PackagesDir)/ParatextData.$(ParatextNugetVersion)/lib/netstandard2.0/Paratext.LexicalContracts.dll" />
			<NuGottenFiles Include="$(PackagesDir)/ParatextData.$(ParatextNugetVersion)/lib/netstandard2.0/Paratext.LexicalContractsV2.dll" />
			<NuGottenFiles Include="$(PackagesDir)/ParatextData.$(ParatextNugetVersion)/lib/netstandard2.0/ParatextData.dll" />
			<NuGottenFiles Include="$(PackagesDir)/ParatextData.$(ParatextNugetVersion)/lib/netstandard2.0/PtxUtils.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.DesktopAnalytics.4.0.0/lib/net461/DesktopAnalytics.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/FormattedEditor.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/HelpSystem.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/HtmlEditor.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/NetLoc.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/ParatextShared.dll" />
			<NuGottenFiles Include="$(PackagesDir)/SIL.ParatextShared.7.4.0.1/runtimes/$(OsDir)/lib/net40/Utilities.dll" />
			<NuGottenFiles Include="$(PackagesDir)/mixpanel-csharp.6.0.0/lib/net461/Mixpanel.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.Numerics.Vectors.4.5.0/lib/net46/System.Numerics.Vectors.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.Net.Http.4.3.4/lib/net46/System.Net.Http.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.Numerics.Vectors.4.5.0/lib/net46/System.Numerics.Vectors.dll" />
			<NuGottenFiles Include="$(PackagesDir)/system.resources.extensions/8.0.0/lib/netstandard2.0/System.Resources.Extensions.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.Runtime.CompilerServices.Unsafe.6.0.0/lib/net461/System.Runtime.CompilerServices.Unsafe.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.Threading.Tasks.Extensions.4.5.4/lib/net461/System.Threading.Tasks.Extensions.dll" />
			<NuGottenFiles Include="$(PackagesDir)/System.ValueTuple.4.5.0/lib/net461/System.ValueTuple.dll" />
		</ItemGroup>
		<Copy
			SourceFiles="@(NuGottenForBuildTasks)"
			DestinationFolder="$(MSBuildThisFileDirectory)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
		<Copy
			SourceFiles="@(NuGottenFiles)"
			DestinationFolder="$(dir-outputBase)/%(RecursiveDir)"
			SkipUnchangedFiles="true"
			OverwriteReadOnlyFiles="true"
		/>
	</Target>
	<Target Name="setRegistryValues" DependsOnTargets="initWindows;setKeysInHKCU" />
	<Target Name="setKeysInHKCU" Condition="'$(packaging)' != 'yes'">
		<Message Text="Setting registry values for $(fwrt)." />
		<!-- Using the OS-appropriate directory separator character is required for some unit tests to pass -->
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/FieldWorks/$(FWMAJOR)/RootCodeDir"
			Value="$(dir-fwdistfiles)"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/FieldWorks/$(FWMAJOR)/RootDataDir"
			Value="$(dir-fwdistfiles)"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/FieldWorks/$(FWMAJOR)/ProjectsDir"
			Value="$([System.IO.Path]::Combine(&quot;$(dir-fwdistfiles)&quot;, &quot;Projects&quot;))"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/Icu$(IcuVersion)DataDir"
			Value="$(dir-icuData)"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/SilEncConverters40/RootDir"
			Value="$(dir-outputBase)"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/SilEncConverters40/DeveloperPluginDir"
			Value="$(dir-outputBase)\EC\Plugins"
			Condition="'$(OS)'=='Windows_NT'"
		/>
		<MakeDir Directories="$(fwrt)/DistFiles/SIL/Repository" />
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/SIL/EncodingConverterRepository/Registry"
			Value="$(fwrt)/DistFiles/SIL/Repository/mappingRegistry.xml"
		/>
		<!-- Register silfw:// link protocol -->
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/Classes/silfw/"
			Value="URL:SILFW Protocol"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/Classes/silfw/URL Protocol"
		/>
		<WriteRegistry
			Hive="CurrentUser"
			Key="$(BUILDAGENT_HKCU)SOFTWARE/Classes/silfw/shell/open/command/"
			Value="&quot;$(dir-outputBase)/FieldWorks.exe&quot; %1"
		/>
	</Target>
</Project>
